#!/usr/bin/env escript
%%! 


main([ListenPort, Forward]) ->
  Root = filename:join(filename:dirname(escript:script_name()), "..")++"/",
  true = code:add_pathz(Root ++ "ebin"),
  true = code:add_pathz(Root ++ "deps/rtmp/ebin"),
  true = code:add_pathz(Root ++ "deps/log4erl/ebin"),
  true = code:add_pathz(Root ++ "deps/amf/ebin"),
  true = code:add_pathz(Root ++ "deps/erlmedia/ebin"),
  application:start(log4erl),
  application:start(rtmp),
  ems:rebuild(),
  {ok, Pid} = rtmp_proxy:run(list_to_integer(ListenPort), Forward),
  erlang:monitor(process, Pid),
  receive
    {'DOWN', _, process, Pid, _Reason} -> ok
  end,
  ok;
  
main(_) ->
  io:format("CommandsPath ~n").
